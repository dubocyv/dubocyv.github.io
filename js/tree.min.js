var LAN_Domain="ep.parl.union.eu",EDMZ_Domain="europarl.europa.eu",logServerBase="http://eicilogs";if(void 0===adaBaseUrl)var adaBaseUrl="http://www.europarl.ep.ec/ada/menugauche/consultation/applications/resultat.cfm?IDENTIFICATION=";if(void 0===epFoundryBaseUrl)var epFoundryBaseUrl="http://www.ep-foundry.ep.parl.union.eu";if(void 0===arisBaseUrl)var arisBaseUrl="http://www.aris.ep.parl.union.eu/#default/item/c.system.EBA_DEV.";if(void 0===relationsBaseUrl)var relationsBaseUrl="/relations/?root=";var baseSvg,svgGroup,mainRoot,root,previousRoot,nodes,links,nbSelected,linkTip,tooltip,divD,divHidden,divI,runOnce=0,totalNodes=0,maxLabelLength=0,i=0,viewerWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||document.body.offsetWidth,viewerHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||document.body.offsetHeight,tree=d3.layout.tree().size([viewerHeight,viewerWidth]),rootStyles=window.getComputedStyle(document.querySelector("html")),selectedStrokeColor=rootStyles.getPropertyValue("--selectedStrokeColor"),nodeFontSize=rootStyles.getPropertyValue("--nodeFontSize"),t1=rootStyles.getPropertyValue("--timing1"),t2=rootStyles.getPropertyValue("--timing2"),t3=rootStyles.getPropertyValue("--timing3"),divDW=rootStyles.getPropertyValue("--divDW"),divDH=rootStyles.getPropertyValue("--divDH"),ttOpacity=rootStyles.getPropertyValue("--ttOpacity"),ttTiming=rootStyles.getPropertyValue("--ttTiming"),maxNodesExpand=rootStyles.getPropertyValue("--maxNodesExpand"),iconW=rootStyles.getPropertyValue("--iconWidth"),iconH=rootStyles.getPropertyValue("--iconHeight"),iconBel=rootStyles.getPropertyValue("--iconBel"),iconLux=rootStyles.getPropertyValue("--iconLux"),iconFra=rootStyles.getPropertyValue("--iconFra"),iconAct=rootStyles.getPropertyValue("--iconAct"),circleActiveCol=rootStyles.getPropertyValue("--circleActiveCol"),circleUpCol=rootStyles.getPropertyValue("--circleUpCol"),circleDownCol=rootStyles.getPropertyValue("--circleDownCol"),circleDmzCol=rootStyles.getPropertyValue("--circleDmzCol"),circleConfCol=rootStyles.getPropertyValue("--circleConfCol"),circleChildImgCol=rootStyles.getPropertyValue("--circleChildImgCol"),circleChildCol=rootStyles.getPropertyValue("--circleChildCol"),circleImgCol=rootStyles.getPropertyValue("--circleImgCol"),circleCol=rootStyles.getPropertyValue("--circleCol"),circleTipChildImgCol=rootStyles.getPropertyValue("--circleTipChildImgCol"),circleTipChildCol=rootStyles.getPropertyValue("--circleTipChildCol"),circleTipImgCol=rootStyles.getPropertyValue("--circleTipImgCol"),circleTipCol=rootStyles.getPropertyValue("--circleTipCol");selectedStrokeColor||(selectedStrokeColor="#f42"),nodeFontSize||(nodeFontSize=12),t1||(t1=400),t2||(t2=600),t3||(t3=300),divDW||(divDW=600),divDH||(divDH=400),ttOpacity||(ttOpacity=.98),ttTiming||(ttTiming=50),maxNodesExpand||(maxNodesExpand=15),iconW||(iconW=12),iconH||(iconH=12),iconBel||(iconBel="/images/bel.png"),iconLux||(iconLux="/images/lux.png"),iconFra||(iconFra="/images/fra.png"),iconAct||(iconAct="/images/active.svg"),circleUpCol||(circleUpCol="#0f0"),circleDownCol||(circleDownCol="#f00"),circleDmzCol||(circleDmzCol="#ff0"),circleConfCol||(circleConfCol="#000"),circleChildImgCol||(circleChildImgCol="blue"),circleChildCol||(circleChildCol="lightsteelblue"),circleImgCol||(circleImgCol="orange"),circleCol||(circleCol="#fff"),circleTipChildImgCol||(circleTipChildImgCol="blue"),circleTipChildCol||(circleTipChildCol="lightsteelblue"),circleTipImgCol||(circleTipImgCol="orange"),circleTipCol||(circleTipCol="#fff"),circleActiveCol||(circleActiveCol="#ff0");iconW=Number(iconW),iconH=Number(iconH);var Aimg=[""],Aindex=-1,HTTPS=0;"https:"===location.protocol&&(HTTPS=1);var zoomListener=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",zoom),isIE=!!document.documentMode;function openInNewTab(e){d3.event.preventDefault(),d3.event.returnValue=!1,window.open(e,"_blank").focus()}function stripName(e){return e.startsWith(",0,")||e.startsWith(",1,")||e.startsWith(",2,")||e.startsWith(",3,")||e.startsWith(",b,")||e.startsWith(",l,")||e.startsWith(",s,")?e.substr(3):e.endsWith(",0,")||e.endsWith(",1,")||e.endsWith(",2,")||e.endsWith(",3,")||e.endsWith(",b,")||e.endsWith(",l,")||e.endsWith(",s,")||e.endsWith(",a,")?e.slice(0,e.length-3):e}function zoom(){svgGroup.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function collapse(e){e.children&&(e._children=e.children,e._children.forEach(collapse),e.children=null)}function expand(e){e._children&&(e.children=e._children,e.children.forEach(expand),e._children=null)}function collapseTree(){root.children.forEach(collapse),update(root),centerNode(root)}function expandTree(){root.children.forEach(expand),update(root),centerNode(root)}function search(e){if(void 0!==e&&0!=e.length)var t=e;else{e=document.getElementById("searchField").value;t=new RegExp(e,"i")}e.length<2||(document.getElementById("searching").innerHTML="Searching: "+t,nbSelected=0,root.children.forEach(searchChildren,t),document.getElementById("searching").innerHTML="Found: "+nbSelected,expandSelected(root),update(root),centerTree(root))}function clearResult(){nbSelected=0,root.children.forEach(clearNodes),document.getElementById("searching").innerHTML="",update(root)}function clearNodes(e){e.selected=0,e.children?e.children.forEach(clearNodes):e._children&&e._children.forEach(clearNodes)}function searchChildren(e){e.selected=0,null!=e.name.match(this)&&(nbSelected+=1,e.selected=1,addToScope(e)),e.children?e.children.forEach(searchChildren,this):e._children&&e._children.forEach(searchChildren,this)}function addToScope(e){e.parent!=root&&(e.parent.selected=1,addToScope(e.parent))}function collapse_s(e){e.parent=this,e.children&&(e._children=e.children,e._children.forEach(collapse_s,e),e.children=null)}function expandSelected(e){if(0!=e.selected)if(e._children)e._children.length>maxNodesExpand?e._children.forEach(expandSelected):(e.children=e._children,e.children.forEach(expandSelected),e._children=null);else if(e.children){if(e.children.length>maxNodesExpand)return;e.children.forEach(expandSelected)}}function collapseNeighboursUpToRoot(e){e.parent!=e&&(p=e.parent,"undefined"!=p.children&&p.children.forEach(function(t){t!=e&&collapse_s(t)}),collapseNeighboursUpToRoot(p))}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),$.extend({getUrlVars:function(){for(var e,t=[],r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<r.length;n++)e=r[n].split("="),t.push(e[0]),t[e[0]]=e[1];return t},getUrlVar:function(e){return $.getUrlVars()[e]}});var levelOpened=0;function update(e){var t=[1];levelOpened=0;var r=function(e,n){n.children&&n.children.length>0&&(t.length<=e+1&&t.push(0),t[e+1]+=n.children.length,levelOpened=Math.max(levelOpened,e+1),n.children.forEach(function(t){r(e+1,t)}))};r(0,root);var n=45*d3.max(t);tree=tree.size([n,viewerWidth]),nodes=tree.nodes(root).reverse(),links=tree.links(nodes),maxLabelLength<30&&(maxLabelLength=30),nodes.forEach(function(e){e.y=e.depth*(maxLabelLength*nodeFontSize)/2}),node=svgGroup.selectAll("g.node").data(nodes,function(e){return e.id||(e.id=++i)});var o=node.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("mouseover",function(e){if(e.url&&(e.children||e._children?linkTip.html($("#dialog").length?"&lt;CTRL&gt;-click to follow link in new tab<br>&lt;SHIFT&gt;&lt;CTRL&gt;-click for popup":"&lt;CTRL&gt;-click to follow link in new tab").transition().duration(t3).style("opacity",.98):$("#dialog").length&&linkTip.html("&lt;CTRL&gt;-click for a new tab").transition().duration(t3).style("opacity",.8)),e.tip){var t=this.getScreenCTM().translate(+this.getAttribute("cx"),+this.getAttribute("cy"));tooltip.html(e.tip).transition().duration(ttTiming).style("left",window.pageXOffset+t.e-10+"px").style("top",window.pageYOffset+t.f+20+"px").style("opacity",ttOpacity)}}).on("mouseout",function(e){e.url&&linkTip.html("").transition().duration(t3).style("opacity",0),e.tip&&tooltip.html("").transition().duration(t3).style("opacity",0)});o.append("circle").attr("class",function(e){return e.desc?"nodeCircleTip":"nodeCircle"}).attr("r",0).style("fill",function(e){return e._children?e.img||e.Aimg?circleChildImgCol:circleChildCol:e.img||e.Aimg?circleImgCol:circleCol}).on("click",function(e){if(e.img)baseSvg.attr("filter","opacity(25%) blur(2px)"),divI.style("pointer-events","inherit").html("<img class=displayed src="+e.img+">").transition().duration(t2).style("opacity",.95);else if(e.Aimg){Aindex=0,Aimg=e.Aimg;for(var t=0;t<Aimg.length;t++)divHidden.html("<img src="+Aimg[t]+">");baseSvg.attr("filter","opacity(25%) blur(2px)"),divI.style("pointer-events","inherit").html("<img class=displayed src="+e.Aimg[Aindex]+">").transition().duration(t2).style("opacity",.95)}else e.url?(d3.event.shiftKey&&e.parent&&(p=e.parent,p.children.forEach(function(t){e!=t&&t.children&&(t._children=t.children,t.children=null)})),(e.children||e._children)&&update(e=toggleChildren(e)),centerNode(e)):(baseSvg.attr("filter",""),divD.html("").style("pointer-events","none").transition().duration(t1).style("opacity",0));e.desc?(baseSvg.attr("filter","opacity(33%) drop-shadow(3px 3px 4px #44f)"),divD.style("pointer-events","inherit").html("<strong>"+e.name+"</strong><div class=closeB><input type='button' value='&times;' id='closeB' onclick=\"closeBf()\"/></div><hr>"+e.desc).transition().duration(t3).style("opacity",.98)):e.desc||e.img||e.Aimg||(e.children||e._children)&&click(e),centerNode(e)}),o.append("svg:title").text(function(e){if(e!=root){if(" VM"===e.name){e.title="Nb of hosts (without integration): "+function e(t){var r=0;if(null!=t._children)var n=t._children;else n=t.children;for(var o=0;o<n.length;o++)n[o].name.startsWith(" ")||"prod"===n[o].name||"qual"===n[o].name||"fp"===n[o].name||"dev"===n[o].name?r+=e(n[o]):r+=1;return t.title="Nb of hosts: "+r,r}(e)}else null!=e._children&&e._children.length&&(e._children[0].name.includes("eici")||e._children[0].name.includes("epsv"))&&(e.title="Nb of hosts: "+e._children.length);return e.title?e.title:void 0}}),o.append("image").attr("xlink:href",function(e){return null!=e.icon?e.icon:""}).attr("class",function(e){return null!=e.icon?"flag":""}).attr("x",function(e){return null!=e.icon?e.children||e._children?10:-(10+iconW):-4e3}).attr("y",function(e){return null!=e.icon?-iconW/2:-4e3}).attr("width",function(e){return null!=e.icon?iconW:0}).attr("height",function(e){return null!=e.icon?iconH:0}),o.append("svg:a").attr("xlink:href",function(e){return e.url}).attr("target",function(e){return e.url?HTTPS&&e.url.startsWith("http:")?"_blank":"winInfo":"none"}).append("svg:text").attr("x",function(e){return e.children||e._children?-10:10}).attr("dy",".35em").attr("class",function(e){return e.url?"node a":"node text"}).attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).text(function(e){return e.name}).style("transform",function(e){switch(e.depth){case 0:return"scale(1.50,1.50)";case 1:return"scale(1.30,1.30)";case 2:return"scale(1.20,1.20)";case 3:return"scale(1.10,1.10)";default:return"none"}}).on("click",click).style("fill-opacity",1e-6),node.select("text").attr("x",function(e){return e.children||e._children?-10:10}).attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).text(function(e){return stripName(e.name)}),node.select("circle.nodeCircle").attr("r",4.5).style("fill",function(e){return null!=e.fill?e.fill:e._children?e.img||e.Aimg?circleChildImgCol:circleChildCol:e.img||e.Aimg?circleImgCol:circleCol}),node.select("circle.nodeCircleTip").attr("r",4.5).style("fill",function(e){return e._children?e.img||e.Aimg?circleTipChildImgCol:circleTipChildCol:e.img||e.Aimg?circleTipImgCol:circleTipCol}),node.transition().duration(t1).attr("transform",function(e){return"translate("+e.y+","+e.x+")"}).select("text").style("fill-opacity",1);var l=node.exit().transition().duration(t1).attr("transform",function(t){return"translate("+e.y+","+e.x+")"}).remove();l.select("circle").attr("r",0),l.select("path").attr("r",1e-6),l.select("text").style("fill-opacity",0);var c=svgGroup.selectAll("path.link").data(links,function(e){return e.target.id});c.enter().insert("path","g").attr("class","link").attr("d",function(e){if(void 0!==e.source.y0)return"M"+e.source.y0+","+e.source.x0+"C"+e.source.y0+","+e.source.x0+" "+e.source.y0+","+e.source.x0+" "+e.source.y0+","+e.source.x0}),c.transition().duration(t1).attr("class","link").style("stroke",function(e){return e.target.selected?selectedStrokeColor:""}).attr("d",function(e){return"M"+e.source.y+","+e.source.x+"C"+(e.source.y+e.target.y)/2+","+e.source.x+" "+(e.source.y+e.target.y)/2+","+e.target.x+" "+e.target.y+","+e.target.x}),c.exit().transition().duration(t1).attr("class","link").attr("d",function(e){return"M"+e.source.y+","+e.source.x+"C"+e.source.y+","+e.source.x+" "+e.source.y+","+e.source.x+" "+e.source.y+","+e.source.x}).remove(),nodes.forEach(function(e){e.x0=e.x,e.y0=e.y})}function sortChildren(e){e.children&&(void 0===e.sort&&void 0===e.group||e.children.sort(function(e,t){return t.name.toLowerCase()<e.name.toLowerCase()?1:-1}),e.children.forEach(function(e){sortChildren(e)}))}function groupChildren(e){if(e.children){if(""==e.group&&e.children.forEach(function(e){groupChildren(e)}),e.children.length>0&&void 0!==e.group){var t=null,r=null,o=!1,i=";",l=0,c=0,a=[],d=[];for(a[c]=0,d[c]=0,e.children.forEach(function(s){r=function(e){var t=e.name.split(i)[0];return t.startsWith(" ")?t:t.toLowerCase()}(s);var u=function(e){var t=e.name.indexOf(i);return t>0?e.name.substr(t+1):null}(s);if(null==u)return s.url?!r.match(/^ /)||r.match(/ Doc folder/)||r.match(/ ARIS /)||r.match(/ Relations graph/)||r.match(/ ADA reference/)||(s.url=""):(s.name=r,n=stripName(r),e.group.match("/")&&(s.url=e.group+encodeURIComponent(n))),l+=1,a[c+=1]=l,void(d[c]=0);r!=t&&(o=function(){if(""!=e.group)if(e.group.match("/"))if(pname=e.name.replace(/^ /,""),pname.match(/tc$/)||pname.match(/tc-node/)||pname.match(/tc-dmz/))if(logServer="dev"==r?"dv.":"qual"==r?"pp.":"prod"==r?".":"fp"==r?"fp.":"int"==r?"it.":"",logServer)pname.match(/tc-dmz/)?logServer=logServerBase+logServer+EDMZ_Domain+"/"+pname.replace(/tc-dmz/,""):pname.match(/tc-node/)?logServer=logServerBase+logServer+LAN_Domain+"/"+pname.replace(/tc-node/,"-node"):logServer=logServerBase+logServer+LAN_Domain+"/"+pname.replace(/tc$/,""),logServer+="/tomcat/logs/",o=e.children.push({name:r+" (logs)",url:logServer,group:e.group,children:[]});else{var t=new RegExp(e.name.match(/-dmz$/));n=stripName(r),o=e.children.push(r.match(/^ /)?{name:r,group:e.group,children:[]}:{name:r,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}),!(r.match(/^ /)&&t.length&&r.match(t))||(e.url="")}else n=stripName(r),o=e.children.push(" blue,a,"==r||" green,a,"==r?{name:stripName(r),icon:iconAct,fill:circleActiveCol,group:e.group,children:[]}:r.match(/^ /)||"dev"==r||"qual"==r||"prod"==r||"fp"==r||"lab"==r||"charge"==r||"int"==r?{name:r,group:e.group,children:[]}:r.endsWith(",l,")?{name:stripName(r),icon:iconLux,fill:circleUpCol,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.endsWith(",b,")?{name:stripName(r),icon:iconBel,fill:circleUpCol,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.endsWith(",s,")?{name:stripName(r),icon:iconFra,fill:circleUpCol,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.startsWith(",0,")?{name:r,fill:circleDownCol,title:"Host not running",url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.startsWith(",1,")?{name:r,fill:circleUpCol,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.startsWith(",2,")?{name:r,fill:circleDmzCol,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.startsWith(",3,")?{name:r,fill:circleConfCol,title:"Zone configured, not runnable",url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("eicil")?{name:r,icon:iconLux,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("eicib")?{name:r,icon:iconBel,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("eicis")?{name:r,icon:iconFra,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("epsvl")?{name:r,icon:iconLux,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("epsvb")?{name:r,icon:iconBel,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").startsWith("epsvs")?{name:r,icon:iconFra,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").toLowerCase().match(/^uc..l/)?{name:r,icon:iconLux,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").toLowerCase().match(/^uc..b/)?{name:r,icon:iconBel,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:r.replace(/^ /,"").toLowerCase().match(/^uc..s/)?{name:r,icon:iconFra,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]}:{name:r,url:e.group+encodeURIComponent(n.replace(/^ /,"")),group:e.group,children:[]});else o=e.children.push({name:r,group:e.group,children:[]});else o=e.children.push({name:r,children:[]});return o}(),d[c]&&(a[c+=1]=l,d[c]=0),t=r),o&&""!=e.group&&(u.match("^_adaID_")?(s.url=u.slice(7,u.lastIndexOf("_")),s.name=u.slice(u.lastIndexOf("_")+1),null==s.name&&(s.name=" ADA reference"),s.url=adaBaseUrl+s.url):u.match("^_arisID_")?(s.url=u.slice(u.lastIndexOf("_arisID_")+8),s.name="  ARIS (Connect)",s.url=arisBaseUrl+s.url+".-1"):u.match("^_epFoundry_DESCR_")?(s.name=u.slice(17,u.lastIndexOf("_URL_")),s.url=u.slice(u.lastIndexOf("_URL_")+5),null==s.name&&(s.name=" EP Foundry reference"),s.url=epFoundryBaseUrl+s.url):u.match("^_connectREF_")?(s.name="  Relations graph",s.url=u.slice(u.lastIndexOf("_connectREF_")+12),s.url=relationsBaseUrl+encodeURIComponent(s.url)):u.match("file://")?(s.url=u,s.name="  Doc folder"):(u.endsWith("~")&&(s.tip=u.slice(u.indexOf("~")+1,u.length-1),u=u.slice(0,u.length-s.tip.length-2),s.tip=u.slice(u.lastIndexOf(i)+1)+" :<hr>"+s.tip),s.name=u,n=stripName(u),e.group.match("/")&&!n.match(/^ /)&&(s.url=e.group+encodeURIComponent(n)),u.match(i)||(u.endsWith(",")?u.endsWith(",l,")?(s.icon=iconLux,s.fill=circleUpCol):u.endsWith(",b,")?(s.icon=iconBel,s.fill=circleUpCol):u.endsWith(",s,")&&(s.icon=iconFra,s.fill=circleUpCol):u.startsWith(",")?u.startsWith(",0,")?(s.fill=circleDownCol,s.title="Host not running"):u.startsWith(",1,")?s.fill=circleUpCol:u.startsWith(",2,")?s.fill=circleDmzCol:u.startsWith(",3,")&&(s.fill=circleConfCol,s.title="Zone configured, not runnable"):u.replace(/^ /,"").startsWith("eicib")||u.replace(/^ /,"").startsWith("epsvb")||u.replace(/^ /,"").toLowerCase().match(/^uc..b/)?s.icon=iconBel:u.replace(/^ /,"").startsWith("eicil")||u.replace(/^ /,"").startsWith("epsvl")||u.replace(/^ /,"").toLowerCase().match(/^uc..l/)?s.icon=iconLux:(u.replace(/^ /,"").startsWith("eicis")||u.replace(/^ /,"").startsWith("epsvs")||u.replace(/^ /,"").toLowerCase().match(/^uc..s/))&&(s.icon=iconFra))),e.children[o-1].children.push(s),d[c]+=1),l+=1});c>=0;)d[c]&&e.children.splice(a[c],d[c]),c-=1}""!=e.group&&e.children.forEach(function(e){groupChildren(e)})}}function visit(e,t,r){if(e){t(e);var n=r(e);if(n)for(var o=n.length,i=0;i<o;i++)n[i].parent=e,visit(n[i],t,r)}}function centerNode(e){scale=zoomListener.scale(),x=-e.y0-maxLabelLength*nodeFontSize/4,y=-e.x0,x=x*scale+viewerWidth/2,y=y*scale+viewerHeight/2,d3.select("g").transition().duration(t1).attr("transform","translate("+x+","+y+")scale("+scale+")"),zoomListener.scale(scale),zoomListener.translate([x,y])}function centerTree(){var e=9999,t=0;visit(root,function(r){isNaN(r.x0)||(e=Math.min(e,r.x0),t=Math.max(t,r.x0))},function(e){return e.children&&e.children.length>0?e.children:null}),scale=zoomListener.scale(),x=-levelOpened*maxLabelLength*nodeFontSize/4,y=-(t+e)/2,x=x*scale+viewerWidth/2,y=y*scale+viewerHeight/2,d3.select("g").transition().duration(t1).attr("transform","translate("+x+","+y+")scale("+scale+")"),zoomListener.scale(scale),zoomListener.translate([x,y])}function toggleChildren(e){return e.children?(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null),e}function click(e){var t=1;if(null==d3.event.returnValue||!d3.event.defaultPrevented){if(d3.event.ctrlKey&&d3.event.altKey)e.children&&(t=0),previousRoot=root,root=e,setTipOnRoot(),d3.event.preventDefault(),d3.event.returnValue=!1;else if(e.url){if(e.url.match("^file://")&&!isIE)return linkTip.html("Only accessible from IE"),void d3.event.preventDefault();if(d3.event.ctrlKey&&d3.event.shiftKey)return popupDialog(e,1),d3.event.preventDefault(),void(d3.event.returnValue=!1);if(d3.event.ctrlKey)return void(isIE&&openInNewTab(e.url));(e.children||e._children)&&(d3.event.preventDefault(),d3.event.returnValue=!1)}else d3.event.returnValue=!0;d3.event.shiftKey&&e.parent&&(p=e.parent,p.children.forEach(function(t){e!=t&&t.children&&(t._children=t.children,t.children=null)})),(e.children||e._children)&&d3.event.altKey&&!d3.event.ctrlKey&&(e.children&&"undefined"!=e.children?e.children.forEach(collapse):e._children&&"undefined"!=e._children&&e._children.forEach(expand)),t&&(e=toggleChildren(e)),update(e),d3.event.ctrlKey&&d3.event.altKey?(centerTree(root),zoomListener.scale(1)):centerNode(e),e.children&&"undefined"!=e.children||e._children&&"undefined"!=e._children||e.url&&(e.url.startsWith(relationsBaseUrl)?openInNewTab(e.url):e.url.startsWith("http:")?openInNewTab(e.url):e.url.startsWith("https:")?openInNewTab(e.url):e.url.startsWith(arisBaseUrl)?openInNewTab(e.url):e.url.startsWith(epFoundryBaseUrl)?openInNewTab(e.url):popupDialog(e))}}function popupDialog(e,t){null!=d3.event.returnValue&&d3.event.defaultPrevented||(HTTPS&&e.url.startsWith("http:")?openInNewTab(e.url):$("#dialog").length?($("#dialog").dialog({close:function(){document.getElementById("cmdbInfo").src=""},position:{my:"center",at:"center",of:window},width:900,height:600,title:'"'+stripName(e.name)+'"'}).dialogExtend({closable:!0,maximizable:!0,minimizable:!0,minimizeLocation:"left",collapsable:!1,dblclick:"collapse"}),isIE?(window.frames.cmdbInfo.document.body.style.cursor="wait",window.frames.cmdbInfo.document.body.style.color="blue",window.frames.cmdbInfo.document.body.innerHTML="Loading..."):(window.frames[0].document.body.style.cursor="wait",window.frames[0].document.body.style.color="blue",window.frames[0].document.body.innerHTML="Loading..."),isIE?document.getElementById("cmdbInfo").src=e.url:!t||(document.getElementById("cmdbInfo").src=e.url),$("#dialog").dialog("open")):openInNewTab(e.url))}function closeBf(){baseSvg.attr("filter",""),divD.style("pointer-events","none").html("").transition().duration(t1).style("opacity",0)}function setTipOnRoot(){if(void 0!==mainRoot.tip&&mainRoot.tip.startsWith("_UPDATED_")){var e="<small>(updated on "+mainRoot.tip.substr(9)+")</small>";root==mainRoot?root.tip=e:void 0!==root.tip?root.tip+="<br>"+e:root.tip=e}else root!=mainRoot&&mainRoot.tip.match("updated on ")&&(root.tip=mainRoot.tip)}null==window.jsonFile?jsonFile="data.json":jsonFile=window.jsonFile,treeJSON=d3.json(jsonFile,function(e,t){if(!runOnce){if(baseSvg=d3.select("#tree-container").append("svg").attr("width",viewerWidth<<1).attr("height",viewerHeight<<1).attr("class","overlay").call(zoomListener),svgGroup=baseSvg.append("g"),$("#dialog").length&&$("#dialog").dialog({autoOpen:!1}),divI=d3.select("body").append("div").attr("class","imagesTT").style("opacity",0).on("touchmove",function(){Aindex>=0&&Aindex<Aimg.length-1&&(Aindex+=1,divI.html("<img class=displayed src="+Aimg[Aindex]+">"))}).on("click",function(){baseSvg.attr("filter",""),divI.style("pointer-events","none").html("").transition().duration(t1).style("opacity",0)}),divHidden=d3.select("body").append("div").style("display","none"),divD=d3.select("body").append("div").attr("class","descriptionTT").style("left",(viewerWidth>>1)-(divDW>>1)+"px").style("top",(viewerHeight>>1)-(divDH>>1)+"px").style("width",divDW+"px").style("pointer-events","none").style("opacity",0),tooltip=d3.select("body").append("div").attr("class","TT").style("opacity",0),linkTip=d3.select("body").append("div").attr("class","linkTip").style("opacity",0),sortChildren(t),groupChildren(t),sortChildren(t),t.parent=t,visit(t,function(e){totalNodes++,e.children&&e.children.length>0&&(maxLabelLength=Math.max(e.name.length,maxLabelLength))},function(e){return e.children&&e.children.length>0?e.children:null}),mainRoot=t,root=t,runtimePattern=$.getUrlVar("runtime"),"undefined"!=typeof runtimePattern&&runtimePattern.length)switch(root_selected=decodeURIComponent(runtimePattern.replace(/\+|%20/g," ")).toLowerCase(),searchPattern=root_selected,(root_selected.match(/-/g)||[]).length){case 0:parent_selected="2";break;case 1:parent_selected="3";break;case 2:parent_selected="4"}if("undefined"==typeof root_selected&&(root_selected=$.getUrlVar("root")),"undefined"!=typeof root_selected&&root_selected.length){function r(e){"undefined"!=typeof parent_selected&&" VM"===e.name||(e.name.toLowerCase()==root_selected&&e.children?root=e:e.children&&e.children.forEach(r))}root_selected=decodeURIComponent(root_selected.replace(/\+|%20/g," ")).toLowerCase(),t.children.forEach(r),root.name!=root_selected&&root_selected.endsWith(" project")&&(root_selected=root_selected.slice(0,root_selected.length-8),t.children.forEach(r))}else if(reroot_selected=$.getUrlVar("reroot"),"undefined"!=typeof reroot_selected&&reroot_selected.length){var n=new RegExp(reroot_selected.replace(/\+|%20/g,"\\s+"),"i");t.children.forEach(function e(t){t.name.match(n)?root=t:t.children&&t.children.forEach(e)})}if(root!=t&&("undefined"==typeof parent_selected&&(parent_selected=$.getUrlVar("parent")),"undefined"!=typeof parent_selected&&parent_selected.match(/^[0-9]$/)))for(i=parent_selected;i--;)root=root.parent;if(setTipOnRoot(),root.x0=viewerHeight/2,root.y0=0,root.children&&root.children.forEach(collapse_s,root),update(root),sp=$.getUrlVar("search"),"undefined"!=typeof sp&&(searchPattern=sp),"undefined"!=typeof searchPattern&&searchPattern.length)search(n=new RegExp(searchPattern.replace(/\+|%20/g,"\\s+"),"i"));centerTree(root),previousRoot=root,runOnce=1}d3.select("body").on("keydown",function(){switch(d3.event.keyCode){case 27:$("#dialog").length&&$("#dialog").dialog("close"),Aindex<0&&(zoomListener.scale(1),centerTree(root));case 32:Aindex>0&&(Aindex=-1,divI.style("pointer-events","none").html("").transition().duration(t1).style("opacity",0),divD.style("pointer-events","none").html("").transition().duration(t1).style("opacity",0),baseSvg.attr("filter",""));break;case 37:case 40:Aindex>0&&(Aindex-=1,divI.html("<img class=displayed src="+Aimg[Aindex]+">"));break;case 13:case 38:case 39:Aindex>=0&&Aindex<Aimg.length-1&&(Aindex+=1,divI.html("<img class=displayed src="+Aimg[Aindex]+">"));break;case 35:Aindex>=0&&(Aindex=Aimg.length-1,divI.html("<img class=displayed src="+Aimg[Aindex]+">"));break;case 36:Aindex>0?(Aindex=0,divI.html("<img class=displayed src="+Aimg[Aindex]+">")):(zoomListener.scale(1),centerTree(root));break;case 222:if(d3.event.shiftKey)root!=mainRoot&&(previousRoot=root,(root=mainRoot).x0=viewerHeight/2,root.y0=0,root.children.childern||collapseNeighboursUpToRoot(previousRoot),update(root),centerTree(root));else if(root!=previousRoot){var e=root;root=previousRoot,previousRoot=e,update(root),centerTree(root)}setTipOnRoot(),root.tip&&tooltip.html("").transition().duration(t3).style("opacity",0)}})}),$(document).ready(function(){$("#searchField").keypress(function(e){13==e.keyCode&&search()})});